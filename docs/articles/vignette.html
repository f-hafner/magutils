<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vignette magutils • magutils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Vignette magutils">
<meta property="og:description" content="magutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">magutils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette.html">Vignette magutils</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Vignette magutils</h1>
            
      
      
      <div class="hidden name"><code>vignette.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">magutils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></code></pre></div>
<p>The package operates on a relational database of bibliometric data
from Microsoft Academic Graph and dissertation data from ProQuest. To
illustrate the usage, the package ships with a small replicate of the
database with the necessary tables. Let’s load the database:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">db_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_example.html">db_example</a></span><span class="op">(</span><span class="st">"AcademicGraph.sqlite"</span><span class="op">)</span>
<span class="va">conn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/connect_to_db.html">connect_to_db</a></span><span class="op">(</span><span class="va">db_file</span><span class="op">)</span>
<span class="co">#&gt; The database connection is: </span>
<span class="co">#&gt; src:  sqlite 3.38.5 [/tmp/RtmptPxKJr/temp_libpath72cc939d74f39/magutils/extdata/AcademicGraph.sqlite]</span>
<span class="co">#&gt; tbls: author_coauthor, author_output, AuthorAffiliation, current_links,</span>
<span class="co">#&gt;   current_links_advisors, FieldsOfStudy, FirstNamesGender, pq_advisors,</span>
<span class="co">#&gt;   pq_authors, pq_fields_mag, pq_unis</span></code></pre></div>
<p>The <code>tbls</code> output above shows the all tables in the
database.</p>
<div class="section level2">
<h2 id="introducing-the-database">Introducing the database<a class="anchor" aria-label="anchor" href="#introducing-the-database"></a>
</h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>The database contains some of the tables originally in MAG and custom
tables created by us. The tables taken from MAG have the same name as in
MAG; the schema to their database is <a href="https://docs.microsoft.com/en-us/academic-services/graph/reference-data-schema#paper-fields-of-study" class="external-link">here</a>.</p>
<p><strong>Naming conventions</strong></p>
<p>The names of the tables in the database and the columns in the tables
follow two different conventions. Tables from MAG are named with
CamelCase, as in the original database; custom tables created by us are
named with snake_case (with a few exceptions not relevant to the
front-end). Columns in MAG tables are named with CamelCase; columns in
custom tables can be named either with CamelCase or snake_case.</p>
<p>Tables from ProQuest data are indicated with a “pq_” prefix; they and
their columns are named with snake_case.</p>
</div>
<div class="section level3">
<h3 id="database-structure">Database structure<a class="anchor" aria-label="anchor" href="#database-structure"></a>
</h3>
<p>The following describes each table; columns irrelevant to the package
are omitted.</p>
<div class="section level4">
<h4 id="tables-current_links-and-current_links_advisors">Tables <code>current_links</code> and
<code>current_links_advisors</code><a class="anchor" aria-label="anchor" href="#tables-current_links-and-current_links_advisors"></a>
</h4>
<p>Tables with links between records in MAG and ProQuest. They are
created outside of the package.</p>
<p><code>current_links</code> has links between the authors
dissertations and authors in MAG. <code>current_links_advisors</code>
has links between the advisors of dissertations and authors in MAG.</p>
<ul>
<li>AuthorId: The author identifier in MAG.</li>
<li>link_score: The probability <span class="math inline">\(\in [0,
1]\)</span> that the linked entities are truly the same. Calculated from
the linking algorithm not part of the package.</li>
<li>iteration_id: The iteration identifer of the linking algorithm; not
relevant for this package.</li>
</ul>
<p>The identifier in ProQuest differs:</p>
<ul>
<li>for <code>current_links</code>, it is goid: The dissertation
identifier in ProQuest.</li>
<li>for <code>current_links_advisors</code>, it is relationship_id: the
combination of dissertation identifier and position of the reported
advisor.</li>
</ul>
</div>
<div class="section level4">
<h4 id="table-fieldsofstudy">Table <code>FieldsOfStudy</code><a class="anchor" aria-label="anchor" href="#table-fieldsofstudy"></a>
</h4>
<p>The fields of study as classified by MAG. The relevant columns
are</p>
<ul>
<li>FieldOfStudyId: field identifier.</li>
<li>NormalizedName: the name of the field.</li>
</ul>
</div>
<div class="section level4">
<h4 id="table-firstnamesgender">Table <code>FirstNamesGender</code><a class="anchor" aria-label="anchor" href="#table-firstnamesgender"></a>
</h4>
<p>Maps first names to gender; data from genderize.io. Columns:</p>
<ul>
<li>FirstName: string of first name</li>
<li>ProbabilityFemale: probability that a person with
<code>FirstName</code> is female.</li>
</ul>
</div>
<div class="section level4">
<h4 id="table-pq_authors">Table <code>pq_authors</code><a class="anchor" aria-label="anchor" href="#table-pq_authors"></a>
</h4>
<p>Table with authors of PhD dissertations from ProQuest. The relevant
columns are:</p>
<ul>
<li>goid</li>
<li>fullname, firstname</li>
<li>degree_year: year of PhD degree.</li>
<li>degree_level: level of the degree; usually PhD or similar.</li>
<li>university_id: identifier of the university.</li>
<li>thesistitle: title of the thesis, normalized to match the paper
titles in MAG.</li>
</ul>
</div>
<div class="section level4">
<h4 id="table-pq_fields_mag">Table <code>pq_fields_mag</code><a class="anchor" aria-label="anchor" href="#table-pq_fields_mag"></a>
</h4>
<p>The fields of the dissertation and their corresponding field (level
0) in MAG.</p>
<ul>
<li>goid</li>
<li>position: position, starting at 0, as reported in the xml files of
the dissertation. The ordering has, to our knowledge, no meaning; but
some dissertations have only one field.</li>
<li>fieldname: the field name as reported in ProQuest</li>
<li>mag_field0: the corresponding field0 in MAG. We make this
correspondence based on similarity of field names and on some tables of
fields from the OECD.</li>
</ul>
</div>
<div class="section level4">
<h4 id="table-pq_unis">Table <code>pq_unis</code><a class="anchor" aria-label="anchor" href="#table-pq_unis"></a>
</h4>
<p>Universities in ProQuest</p>
<ul>
<li>university_id: university identifier</li>
<li>normalizedname: name of the university</li>
<li>location: location of the university. Not standardized, but location
of U.S. universities have all a “United States” string in them.</li>
</ul>
</div>
<div class="section level4">
<h4 id="table-pq_advisors">Table <code>pq_advisors</code><a class="anchor" aria-label="anchor" href="#table-pq_advisors"></a>
</h4>
<p>The dissertation advisors.</p>
<ul>
<li>goid</li>
<li>position: advisor’s position, starting at 0, as reported in the xml
files of the dissertation. The ordering has, to our knowledge, no
meaning; but some dissertations have only one field. A position <span class="math inline">\(&gt; 0\)</span> indicates the dissertation reports
more than one advisor.</li>
<li>lastname, firstname: reported names of the advisor</li>
<li>relationship_id: unique identifier of the student-advisor
relationship. This is just the combined <code>goid</code> and the
<code>position</code>.</li>
</ul>
<p>Note that advisors do not have their own unique identifier.</p>
</div>
</div>
<div class="section level3">
<h3 id="getting-information-on-the-database">Getting information on the database<a class="anchor" aria-label="anchor" href="#getting-information-on-the-database"></a>
</h3>
<p>We can query information from the database schema with some custom
functions.</p>
<p>We can use the following query to see the specific contents of each
table:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="fu"><a href="../reference/sqlite_master_to_df.html">sqlite_master_to_df</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Rows: 30</span>
<span class="co">#&gt; Columns: 4</span>
<span class="co">#&gt; $ type     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "table", "index", "index", "table", "index", "index", "table"…</span>
<span class="co">#&gt; $ name     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "current_links", "idx_t_AuthorIdgoid", "idx_t_goid", "current…</span>
<span class="co">#&gt; $ tbl_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "current_links", "current_links", "current_links", "current_l…</span>
<span class="co">#&gt; $ sql      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "CREATE TABLE `current_links` (\n  `AuthorId` INTEGER,\n  `go…</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="using-the-package">Using the package<a class="anchor" aria-label="anchor" href="#using-the-package"></a>
</h2>
<div class="section level3">
<h3 id="loading-data-from-proquest-get_proquest">Loading data from proquest: <code>get_proquest</code><a class="anchor" aria-label="anchor" href="#loading-data-from-proquest-get_proquest"></a>
</h3>
<p>The function loads the dissertations written in the United States
(available in ProQuest) between <code>start_year</code> and
<code>end_year</code>. The underlying table used for the output depends
on <code>from</code> and is thus either <code>pq_authors</code> when
querying “graduates” or <code>pq_advisors</code> when querying
“advisors”. The final output of the function also depends on
<code>from</code>, and in general the returned columns always refer to
the respective units.</p>
<p>Let’s see an example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graduates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_proquest.html">get_proquest</a></span><span class="op">(</span><span class="va">conn</span>, from <span class="op">=</span> <span class="st">"graduates"</span>, lazy <span class="op">=</span> <span class="cn">FALSE</span>, limit <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">graduates</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span>
<span class="co">#&gt;        goid degree_year university_id fieldname0_mag gender</span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  89<span style="text-decoration: underline;">188</span>005        <span style="text-decoration: underline;">2</span>000           107 engineering    Male  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  89<span style="text-decoration: underline;">237</span>817        <span style="text-decoration: underline;">1</span>985            49 psychology     Male  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 193<span style="text-decoration: underline;">768</span>856        <span style="text-decoration: underline;">1</span>993           505 psychology     Male</span></code></pre></div>
<p>The output consists of the following:</p>
<ul>
<li>The field of study, using <code>define_field</code>: The MAG field
0, mapped from the reported first field of the dissertation.</li>
<li>The gender, using <code>define_gender</code>: The imputed gender
given the first name of the person.</li>
</ul>
<p>Alternatively, we can query advisors:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">advisors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_proquest.html">get_proquest</a></span><span class="op">(</span><span class="va">conn</span>, from <span class="op">=</span> <span class="st">"advisors"</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">advisors</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [6 x 4]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.38.5 [/tmp/RtmptPxKJr/temp_libpath72cc939d74f39/magutils/extdata/AcademicGraph.sqlite]</span></span>
<span class="co">#&gt;        goid position relationship_id gender</span>
<span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  89<span style="text-decoration: underline;">188</span>005        0 89188005_0      <span style="color: #BB0000;">NA</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 193<span style="text-decoration: underline;">768</span>856        0 193768856_0     Male  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 193<span style="text-decoration: underline;">769</span>023        0 193769023_0     Male  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 193<span style="text-decoration: underline;">953</span>537        0 193953537_0     Male  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 193<span style="text-decoration: underline;">973</span>039        0 193973039_0     Male  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 194<span style="text-decoration: underline;">032</span>064        0 194032064_0     Male</span></code></pre></div>
<p>Important here is that the gender refers to the advisor. If we wanted
to study student-advisor matches, we could join the output from
“graduates” to the output from “advisors”, using the column
<code>goid</code> for the join. Note that a student can have multiple
advisors, as indicated by the <code>position</code> column.</p>
</div>
<div class="section level3">
<h3 id="loading-the-links-get_links">Loading the links: <code>get_links</code><a class="anchor" aria-label="anchor" href="#loading-the-links-get_links"></a>
</h3>
<p>This returns the links between records in MAG and in ProQuest. With
<code>from = "graduates"</code>, we get the links from
<code>current_links</code>. With <code>from = "advisors"</code>, we get
the links from <code>current_links_advisors</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">links</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_links.html">get_links</a></span><span class="op">(</span><span class="va">conn</span>, from <span class="op">=</span> <span class="st">"graduates"</span>, lazy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">links</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [6 x 3]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.38.5 [/tmp/RtmptPxKJr/temp_libpath72cc939d74f39/magutils/extdata/AcademicGraph.sqlite]</span></span>
<span class="co">#&gt;     AuthorId      goid link_score</span>
<span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  218<span style="text-decoration: underline;">478</span>716 194<span style="text-decoration: underline;">032</span>064      0.996</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  685<span style="text-decoration: underline;">122</span>076 194<span style="text-decoration: underline;">043</span>915      0.952</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="text-decoration: underline;">2</span>022<span style="text-decoration: underline;">033</span>572 194<span style="text-decoration: underline;">031</span>402      1.00 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">2</span>100<span style="text-decoration: underline;">285</span>539 193<span style="text-decoration: underline;">768</span>856      0.979</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="text-decoration: underline;">2</span>130<span style="text-decoration: underline;">621</span>523  89<span style="text-decoration: underline;">237</span>817      0.979</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">2</span>132<span style="text-decoration: underline;">399</span>126 193<span style="text-decoration: underline;">769</span>023      1.00</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">links</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_links.html">get_links</a></span><span class="op">(</span><span class="va">conn</span>, from <span class="op">=</span> <span class="st">"advisors"</span>, lazy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Note: At the moment, using a link score below 0.95 for advisors can result in suspiciously many false positives. Carefully inspect the linked records you use.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">links</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [6 x 3]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.38.5 [/tmp/RtmptPxKJr/temp_libpath72cc939d74f39/magutils/extdata/AcademicGraph.sqlite]</span></span>
<span class="co">#&gt;     AuthorId relationship_id link_score</span>
<span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="text-decoration: underline;">1</span>584<span style="text-decoration: underline;">137</span>904 1002730962_0         0.995</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">1</span>584<span style="text-decoration: underline;">137</span>904 1015034204_1         0.995</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> <span style="text-decoration: underline;">1</span>584<span style="text-decoration: underline;">137</span>904 2190212570_0         0.999</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">1</span>584<span style="text-decoration: underline;">137</span>904 304122610_0          0.999</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="text-decoration: underline;">1</span>584<span style="text-decoration: underline;">137</span>904 304225816_2          0.999</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">1</span>584<span style="text-decoration: underline;">137</span>904 304320549_0          0.995</span></code></pre></div>
<p>As stated in the message, we suspect the links between advisors need
a higher <code>min_score</code> constraint to omit many false
positives.</p>
</div>
<div class="section level3">
<h3 id="adding-information-to-records-augment_tbl">Adding information to records: <code>augment_tbl</code><a class="anchor" aria-label="anchor" href="#adding-information-to-records-augment_tbl"></a>
</h3>
<p>The function has two purposes:</p>
<ol style="list-style-type: decimal">
<li><p>Join output or affiliation information to author units</p></li>
<li><p>Join information on affiliations of co-authors of author
units</p></li>
</ol>
<div class="section level4">
<h4 id="join-output-or-affiliation-information-to-author-units">Join output or affiliation information to author units<a class="anchor" aria-label="anchor" href="#join-output-or-affiliation-information-to-author-units"></a>
</h4>
<p>The tables used to augment <code>tbl</code> contain multiple rows per
AuthorId, as the following example illustrates:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">graduates_affiliation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_links.html">get_links</a></span><span class="op">(</span>
    conn <span class="op">=</span> <span class="va">conn</span>,
    from <span class="op">=</span> <span class="st">"graduates"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/augment_tbl.html">augment_tbl</a></span><span class="op">(</span>conn <span class="op">=</span> <span class="va">conn</span>,
              with <span class="op">=</span> <span class="st">"affiliation"</span><span class="op">)</span> 

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">graduates_affiliation</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [6 x 5]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.38.5 [/tmp/RtmptPxKJr/temp_libpath72cc939d74f39/magutils/extdata/AcademicGraph.sqlite]</span></span>
<span class="co">#&gt;     AuthorId      goid link_score AffiliationId  Year</span>
<span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  218<span style="text-decoration: underline;">478</span>716 194<span style="text-decoration: underline;">032</span>064      0.996      22<span style="text-decoration: underline;">759</span>111  <span style="text-decoration: underline;">1</span>996</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  218<span style="text-decoration: underline;">478</span>716 194<span style="text-decoration: underline;">032</span>064      0.996      22<span style="text-decoration: underline;">759</span>111  <span style="text-decoration: underline;">1</span>997</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  685<span style="text-decoration: underline;">122</span>076 194<span style="text-decoration: underline;">043</span>915      0.952      32<span style="text-decoration: underline;">971</span>472  <span style="text-decoration: underline;">2</span>015</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  685<span style="text-decoration: underline;">122</span>076 194<span style="text-decoration: underline;">043</span>915      0.952      32<span style="text-decoration: underline;">971</span>472  <span style="text-decoration: underline;">2</span>016</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> <span style="text-decoration: underline;">2</span>022<span style="text-decoration: underline;">033</span>572 194<span style="text-decoration: underline;">031</span>402      1.00        1<span style="text-decoration: underline;">925</span>986  <span style="text-decoration: underline;">2</span>020</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> <span style="text-decoration: underline;">2</span>022<span style="text-decoration: underline;">033</span>572 194<span style="text-decoration: underline;">031</span>402      1.00       16<span style="text-decoration: underline;">109</span>614  <span style="text-decoration: underline;">2</span>005</span></code></pre></div>
<p>For each <code>AuthorId</code>, we have one row for each year in
which there is at least one paper with a reported affiliation of the
author. The same when using <code>with = "output"</code>. The function
checks if there is already a <code>Year</code> column in the
<code>tbl</code>, and if so, it automatically joins on
<code>AuthorId</code> and <code>Year</code> and therefore avoids
duplicates.</p>
</div>
<div class="section level4">
<h4 id="join-information-on-affiliations-of-co-authors-of-author-units-">Join information on affiliations of co-authors of author units.<a class="anchor" aria-label="anchor" href="#join-information-on-affiliations-of-co-authors-of-author-units-"></a>
</h4>
<p>TBD.</p>
</div>
</div>
<div class="section level3">
<h3 id="processing-after-querying">Processing after querying<a class="anchor" aria-label="anchor" href="#processing-after-querying"></a>
</h3>
<p>When should you load the data into memory with
<code>collect()</code>? I suggest to do as many operations as possible
on the database with <code>dbplyr</code>. That said, when data from
ProQuest and MAG are combined, the resulting tables are usually not very
large and should fit into memory.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">conn</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Flavio Hafner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
